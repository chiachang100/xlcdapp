# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools
# Flutter environment for use in GitHub Actions. It works on Linux, Windows, and macOS.
# https://github.com/subosito/flutter-action

name: Deploy to Firebase Hosting on merge
'on':
  push:
    branches:
    - main
jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    - name: Clone Flutter repository with stable channel
      # Set up Flutter.
      uses: subosito/flutter-action@v2
      with:
        #flutter-version: '3.16.9'
        channel: stable
    - run: flutter doctor -v

    # Build and deploy
    - run: |
        flutter --disable-analytics
        flutter pub get
        flutter test
        flutter build web --release
      #- run: flutter build -v web --release
    - uses: FirebaseExtended/action-hosting-deploy@v0
      with:
        repoToken: '${{ secrets.GITHUB_TOKEN }}'
        firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT_XLCDAPP }}'
        channelId: live
        projectId: xlcdapp

    # Build Android APK and app bundle
    #- uses: actions/checkout@v4
    #- uses: subosito/flutter-action@v2
      #with:
        #flutter-version: '3.16.9'
        #channel: stable
    #- run: flutter pub get
    #- run: flutter test
    #- run: flutter build apk
    #- run: flutter build appbundle

  # Build for iOS (macOS only):
  #build:
    #runs-on: macos-latest
    #steps:
    #- uses: actions/checkout@v4
    #- uses: subosito/flutter-action@v2
      #with:
        #flutter-version: '3.16.9'
        #channel: 'stable'
    #- run: flutter pub get
    #- run: flutter test
    #- run: flutter build ios --release --no-codesign
